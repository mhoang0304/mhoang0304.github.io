<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Point Game</title>
    <link rel="stylesheet" href="./style.css">
</head>

<body>
    <canvas id="canvas" style="background-color: black;" width="1000px" height="600px"></canvas>
    <script>
        const canvas = document.getElementById("canvas");
        const c = canvas.getContext("2d");

        class Boss {
            constructor(x, y, radius, color) {
                this.x = x;
                this.y = y;
                this.radius = radius;
                this.color = color;
                this.score = 0;
                this.dx = 5;
                this.dy = 0;
            }
            draw() {
                c.beginPath();
                c.arc(this.x, this.y, this.radius / 3, 0, 2 * Math.PI);
                c.fillStyle = this.color;
                c.fill();
                c.closePath();
            }
            drawBoss() {
                c.beginPath()
                c.arc(this.x, this.y, this.radius, 0, 2 * Math.PI);
                c.fillStyle = this.color;
                c.shadowColor = "white";
                c.shadowBlur = 16;
                c.fill();
                c.closePath();

                c.beginPath();
                c.font = "14px sans-serif";
                c.fillStyle = "white";
                c.fillText("HAHA", this.x - 20, this.y + 5);
                c.closePath();
            }
            drawScore() {
                c.beginPath();
                c.fillStyle = "white";
                c.font = "30px sans-serif";
                c.fillText("Score:", (canvas.width / 20) - 30, canvas.height - 15 );
                c.fillText(this.score, canvas.width / 9, canvas.height - 15);
                c.closePath();
            }
            drawYouWin() {
                c.beginPath();
                c.fillStyle = "white";
                c.font = "40px sans-serif";
                c.fillText("You Win!", (canvas.width / 2) - 80, canvas.height / 2);
            }
            move() {
                if (this.x > canvas.width - this.radius) {
                    boss.dx = -5;
                    boss.dy = 0;
                }
                if (this.x < this.radius) {
                    boss.dx = 5;
                    boss.dy = 0;
                }
                if (this.y > canvas.height - this.radius) {
                    boss.dx = 0;
                    boss.dy = -5;
                }
                if (this.y < this.radius) {
                    boss.dx = 0;
                    boss.dy = 5;
                }
                this.x = this.x + this.dx;
                this.y = this.y + this.dy;
                this.drawScore();
                this.drawBoss();
            }
        }

        var boss = new Boss(25, 25, 25, "yellow", 0);
        var arrayPoint = [];
        var N = 60;
        var gameWin = false;

        addEventListener('keydown', function (event) {
            if (event.keyCode == 40) { // down
                boss.dy = 5;
                boss.dx = 0;
            }
            if (event.keyCode == 38) { //up
                boss.dy = -5;
                boss.dx = 0;
            }
            if (event.keyCode == 39) { //right
                boss.dy = 0;
                boss.dx = 5;
            }
            if (event.keyCode == 37) { // left
                boss.dy = 0;
                boss.dx = -5;
            }
        });

        for (let i = 0; i < N; i++) {
            var pointBall = new Boss(randomPosition(15, canvas.width - 15), randomPosition(15, canvas.height - 15), 30, rgb());
            arrayPoint.push(pointBall);
        }

        function update() {
            arrayPoint.forEach((x) => {
                if (Math.sqrt(Math.pow(boss.x - x.x, 2) + Math.pow(boss.y - x.y, 2)) <= (x.radius + boss.radius)) {
                    boss.score++;
                    arrayPoint.splice(arrayPoint.indexOf(x), 1);
                }
            })
        }

        function gameOver() {
            if (boss.score >= N) {
                gameWin = true;
            }
        }

        function handleGameOver() {
            if (gameWin) {
                console.log("You Win");
                boss.dx = 0;
                boss.dy = 0;
            }
        }

        function animate() {
            if (!gameWin) {
                c.clearRect(0, 0, canvas.width, canvas.height);
                boss.drawBoss();
                boss.drawScore();
                arrayPoint.forEach((x) => x.draw());
                gameOver();
                boss.move();
                update();
                requestAnimationFrame(animate);
            } else {
                handleGameOver();
                boss.drawYouWin();
            }
        }
        animate();

        function randomPosition(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function rgb() {
            color = 'rgb(';
            for (var i = 0; i < 3; i++) {
                color += Math.floor(Math.random() * 255) + ',';
            }
            return color.replace(/\,$/, ')');
        }

    </script>
</body>

</html>